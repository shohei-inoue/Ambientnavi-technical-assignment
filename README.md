# 株式会社アンビエントナビ 技術課題(飲食店向けのモバイルオーダーシステムの開発)

## 必須要件

### ユーザー機能

- ユーザーの登録・ログインができる
- 管理画面で登録したメニューを閲覧することができる
- カートにメニューを追加できる
- 注文をすることができる

### 管理画面機能

- スタッフの登録・ログインができる
- メニューの登録・更新・削除ができる

### Server Actionsの活用

- フォーム送信処理
- データ変更操作
- 画像アップロード

## 自身の中でのペルソナ

- 居酒屋やカジュアルな飲食店
- テーブルで飲食を行う
- 店内QRコードからアクセス

## 技術スタック(技術要件)

- FE: Next.js(App Router)
- SS: Next.js(Server Component, Server Actions)
- DB: postgreSQL
- ORM: Prisma
- styling: Tailwind CSS

## 環境構築(ビルドと開発)

初回起動時にビルドを行う.

```bash
docker-compose build
```

その後、開発を行う場合は以下のコマンドでプロジェクトを立ち上げてください.

```bash
docker-compose up
```

ローカル環境にアクセス：[http://localhost:3000](http://localhost:3000)

## 技術的な工夫点

1. dockerの利用

- 開発環境を Docker 上に構築することで、ローカル環境の差異による問題を排除.
- docker-compose を用いて DB・アプリケーションの依存を簡単に管理.

2. Clean Architecture

- Server Actions を Clean Architecture で構築することによりcontroller, usecase, repository, domain のレイヤーに分離. これによりビジネスロジックとインフラ依存コードを明確に分離し、テスト性・保守性を向上.

3. JWT, Cookieの利用

- フロントエンド/バックエンド間でのセッション管理を安全に行うために JWT を採用.
- Cookieによりセッションの維持を円滑に.

## 追加機能の説明とその選定理由

1.  管理者・顧客のロール分離と昇格機能

    - 理由: 顧客登録済みのユーザーを管理者に昇格できることで、開発や運用時の柔軟なユーザー管理を可能に.
    - 効果: 社員番号と役職情報に基づき管理者アクセスを制限でき、セキュリティと運用性が両立.

2.  テーブルセッション管理機能（QRコード連携）

    - 理由: ユーザーが入店時にテーブル番号からセッションを開始できるようにし、グループ単位での注文履歴・カート管理を可能に.
    - 効果: 実際の飲食店運営に近いUXを実現し、ユーザーの利便性を向上.

3.  タグ機能付きのメニュー分類

    - 理由: メニューに複数のタグを付与することで、サイドメニュー・季節限定などカテゴリ横断の柔軟な表示が可能.
    - 効果: ユーザーの閲覧体験を向上し、プロモーションメニューの訴求にも活用可能.

4.  注文履歴の取得機能（ユーザー単位・テーブル単位）
    - 理由: ユーザーが過去に注文した内容や、テーブル単位での注文の流れを確認できるようにすることで、利用者と店舗の両方にとって利便性の高いオーダー管理を実現.
    - 効果: ユーザーは同じ注文を再利用しやすくなり、店舗側は集計や会計処理、分析にも活用可能.

## 生成AI利用レポート

### 使用したツール

- ChatGPT（OpenAI）

### 具体的な使用場面と目的

- 要件整理および設計段階での構成検討（認証、DB構造、ロール管理）
- Clean Architecture のレイヤー構成や責任分離の設計支援
- Next.js App Router における Server Actions や Middleware 実装の疑問解決
- Prisma を用いたバリデーションやカスタムエラー処理の最適化案の取得
- エラーやビルド失敗時のトラブルシューティング（Docker/TypeScript/Next.js関連）
- デザインの実装(CSS)

### 利用したプロンプト

- 「店内で飲食をするタイプのお店に利用するモバイルオーダーアプリを開発しようと考えるがDBをどのように設計するべきか. 居酒屋をやを想定しており, QRコードから注文する形を想定している」
- 「adminのauth関連を作ろうと思っているが, prismaのUserにroleとemployNumberを追加するか, 新たにAdminUserを作るべきか」
- 「JWT を利用して Next.js middleware で認証とロールごとのルーティングを分けたい」
- 「Next.js15でcookies()が非同期になっているためエラーが発生するのだが, これは以前とどのように使用が変更された？」
- 「ユーザー認証でnext_authやcookie, jwt等の様々な認証があるがどれを使用すべき?」
- 「server actionsでデータをやり取りする場合, ミドルウェアにcorsの対処は必要ない？」
- etc ...

### TODO 
- デザインの統一化
- レスポンシブ対応(スマートフォン)
- 会計処理の追加
